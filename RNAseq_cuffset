## this is a typical pipeline for RNA-seq gene differential expression analysis with Cufflinks
## softwares used: Bowtie2, tophat(inside bowtie2), cufflinks

# 1. donload genome from UCSC database http://hgdownload.cse.ucsc.edu/goldenPath/canFam3/bigZips/canFam3.fa.gz
# dog whole genome canFam3.fa in a comparessed format
wget http://hgdownload.cse.ucsc.edu/goldenPath/canFam3/bigZips/canFam3.fa.gz

# 2. unzip gz file 
gunzip canFam3.fa.gz

# 3. build the index for the reference genome or directly download it from illumina
bowtie2-build canFam3.fa

# 4. load tophat & bowtie2

module load bowtie2

# 5. run tophat
######### use -p equals 4 to enagle multi-core processing
tophat -r 200 -p 4 -o /fs/lustre/wrk/kzhang/samples/dog_207_L1/ canFam3.fa FCC5FUJACXX-DOGegkTAAARBAPEI-207_L7_1.fq.gz FCC5FUJACXX-DOGegkTAAARBAPEI-207_L7_2.fq.gz

tophat -r 200 -p 4 -o /fs/lustre/wrk/kzhang/samples/dog_208_L8/ canFam3.fa FCC5FUJACXX-DOGegkTAABRBAPEI-208_L8_1.fq.gz FCC5FUJACXX-DOGegkTAABRBAPEI-208_L8_2.fq.gz

tophat -r 200 -p 4 -o /fs/lustre/wrk/kzhang/samples/dog_209_L6/ canFam3.fa FCC5FUJACXX-DOGegkTAACRBAPEI-209_L6_1.fq.gz FCC5FUJACXX-DOGegkTAACRBAPEI-209_L6_2.fq.gz

tophat -r 200 -p 4 -o /fs/lustre/wrk/kzhang/samples/dog_210_L6/ canFam3.fa FCC5FUJACXX-DOGegkTAADRBAPEI-210_L6_1.fq.gz FCC5FUJACXX-DOGegkTAADRBAPEI-210_L6_2.fq.gz


# 6. assemble transcriptoms with cufflinks
### performed in each directories
~/software/cufflinks-2.2.1/cufflinks -o dog207 -p 8 accepted_hits.bam 
~/software/cufflinks-2.2.1/cufflinks -o dog208 -p 8 accepted_hits.bam 
~/software/cufflinks-2.2.1/cufflinks -o dog209 -p 8 accepted_hits.bam 
~/software/cufflinks-2.2.1/cufflinks -o dog210 -p 8 accepted_hits.bam

# 7. merge 4 gtf files

########## write the foolwing into assemblies.txt
########## this contains the absolute path of 4 gtf files we gonna merge

/fs/lustre/wrk/kzhang/samples/dog_207_L1/dog207/transcripts.gtf

/fs/lustre/wrk/kzhang/samples/dog_208_L8/dog208/transcripts.gtf

/fs/lustre/wrk/kzhang/samples/dog_209_L6/dog209/transcripts.gtf

/fs/lustre/wrk/kzhang/samples/dog_210_L6/dog210/transcripts.gtf

######### out put into dog07-10/

~/software/cufflinks-2.2.1/cuffmerge -o dog07-10 -p 8 assemblies.txt


# 8. compare the difference
# diff files will be generated to allow for further analysis with GOseq or R packages

 ~/software/cufflinks-2.2.1/cuffdiff -o cuffdiff_output -p 8 -labels 207,208,209,210 merge_07-10/merged.gtf dog_207_L1/accepted_hits.bam dog_208_L8/accepted_hits.bam dog_209_L6/accepted_hits.bam dog_210_L6/accepted_hits.bam








